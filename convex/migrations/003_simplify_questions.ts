import { mutation } from "../_generated/server";

export default mutation({
  handler: async (ctx) => {
    console.log("ğŸ”„ Starting question simplification...");

    // Get all rules to reference their IDs
    const rules = await ctx.db.query("tajweedRules").collect();
    const ruleMap = new Map(rules.map(rule => [rule.slug, rule._id]));


    // Delete existing questions
    const existingQuestions = await ctx.db.query("questions").collect();
    for (const question of existingQuestions) {
      await ctx.db.delete(question._id);
    }
    console.log(`ğŸ—‘ï¸ Deleted ${existingQuestions.length} existing questions`);

    const simplifiedQuestions = [
      // IDGHAM QUESTIONS - Super Clear & Simple
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "Which 6 letters make sounds join together?",
        options: ["ÙŠ Ø± Ù… Ù„ Ùˆ Ù†", "Ø¨ Øª Ø« Ø¬ Ø¯ Ø°", "Ø³ Ø´ Øµ Ø¶ Ø· Ø¸", "Ù Ù‚ Ùƒ Ù‡ Ø® Øº"],
        correctOptionIndex: 0,
        explanation: "These 6 letters: ÙŠ Ø± Ù… Ù„ Ùˆ Ù† make sounds join together. Remember: Ya-Ra-Meem-Lam-Wow-Noon.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "When you say 'Ù…Ù† ÙŠÙ‚ÙˆÙ„', what should you do?",
        options: ["Join the Ù† and ÙŠ sounds together with Ghunnah", "Say Ù† clearly, then ÙŠ", "Skip the Ù† sound", "Say Ù† loudly"],
        correctOptionIndex: 0,
        explanation: "Join the Ù† and ÙŠ sounds together and make a gentle Ghunnah sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "When Ù† meets Ù„ or Ø±, do you make a Ghunnah sound?",
        options: ["Yes, always Ghunnah", "No, join smoothly without Ghunnah", "Sometimes Ghunnah", "Never join them"],
        correctOptionIndex: 1,
        explanation: "No Ghunnah! When Ù† meets Ù„ or Ø±, just join them smoothly together.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "How should you say 'Ù…Ù† Ø±Ø¨Ù‡'?",
        options: ["Say Ù† clearly, then Ø±", "Join Ù† and Ø± smoothly (no Ghunnah)", "Hum between Ù† and Ø±", "Skip the Ù†"],
        correctOptionIndex: 1,
        explanation: "Join the Ù† and Ø± smoothly together without any Ghunnah.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "Which 4 letters make you use use Ghunnah when joining?",
        options: ["ÙŠ Ù† Ù… Ùˆ", "Ù„ Ø± Ù† Ù…", "Ø¨ Øª Ø« Ø¬", "All letters"],
        correctOptionIndex: 0,
        explanation: "Only these 4 letters: ÙŠ Ù† Ù… Ùˆ make you use use Ghunnah when joining. Remember: Ya-Noon-Meem-Wow.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "What does 'joining sounds' mean?",
        options: ["Say each sound separately", "Mix two sounds into one", "Make sounds louder", "Skip some sounds"],
        correctOptionIndex: 1,
        explanation: "Joining sounds means mixing two sounds together so they become one smooth sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "When you Ghunnah, how long should it last?",
        options: ["Very quick", "Count 1-2", "Count 1-2-3", "Very long"],
        correctOptionIndex: 1,
        explanation: "When you Ghunnah, count 1-2. That's the right length - not too short, not too long.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "In 'Ù…Ù† Ù„Ø¯Ù†Ù‡', should you Ghunnah?",
        options: ["Yes, Ghunnah", "No, join smoothly", "Sometimes", "Say clearly"],
        correctOptionIndex: 1,
        explanation: "No Ghunnah! Just join the Ù† and Ù„ smoothly together.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "Which word needs use Ghunnah when you join the sounds?",
        options: ["Ù…Ù† Ø±Ø¨Ù‡", "Ù…Ù† Ù„Ø¯Ù†Ù‡", "Ù…Ù† ÙŠÙ‚ÙˆÙ„", "All of them"],
        correctOptionIndex: 2,
        explanation: "'Ù…Ù† ÙŠÙ‚ÙˆÙ„' needs Ghunnah because ÙŠ is one of the 4 letters that make you use Ghunnah.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("idgham")!,
        prompt: "When Ù† meets Ùˆ, what do you do?",
        options: ["Say them separately", "Join them with Ghunnah", "Join them without Ghunnah", "Skip the Ù†"],
        correctOptionIndex: 1,
        explanation: "Join the Ù† and Ùˆ together and make a gentle Ghunnah sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },

      // IKHFA QUESTIONS - Super Clear & Simple
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "How many letters make you 'hide' the Ù† sound?",
        options: ["10 letters", "15 letters", "20 letters", "All letters"],
        correctOptionIndex: 1,
        explanation: "15 letters make you hide the Ù† sound but still Ghunnah gently.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "When hiding the Ù† sound, what do you do?",
        options: ["Say Ù† clearly", "Join completely", "Hide Ù† but Ghunnah gently", "Skip the Ù†"],
        correctOptionIndex: 2,
        explanation: "Hide the Ù† sound but still make a gentle Ghunnah sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "In 'Ù…Ù† Ù‚Ø¨Ù„', what should you do?",
        options: ["Say Ù† clearly", "Join Ù† and Ù‚", "Hide Ù† but Ghunnah gently", "Skip Ù†"],
        correctOptionIndex: 2,
        explanation: "Hide the Ù† sound but make a gentle Ghunnah before saying Ù‚.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "What does 'hiding' the sound mean?",
        options: ["Skip it completely", "Say it very loudly", "Don't say it clearly but still Ghunnah", "Change it to another sound"],
        correctOptionIndex: 2,
        explanation: "Hiding means you don't say the Ù† clearly, but you still make a gentle Ghunnah sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "How long should you use Ghunnah when hiding Ù†?",
        options: ["Don't Ghunnah", "Count 1", "Count 1-2", "Count 1-2-3"],
        correctOptionIndex: 2,
        explanation: "Hum gently for 1-2 counts when hiding the Ù† sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "In 'Ù…Ù†Ù’ ØªØ­Øª', what happens to the Ù†?",
        options: ["Say it clearly", "Hide it and Ghunnah gently", "Join it with Øª", "Skip it"],
        correctOptionIndex: 1,
        explanation: "Hide the Ù† and make a gentle Ghunnah sound before the Øª.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "Which letter makes you hide the Ù†?",
        options: ["ÙŠ", "Ø±", "Øª", "Ø¨"],
        correctOptionIndex: 2,
        explanation: "Øª is one of the 15 letters that makes you hide the Ù† sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "When hiding Ù†, where should your tongue be?",
        options: ["Touch the next letter's place", "Stay in the middle (don't touch anywhere)", "Touch your teeth", "Touch the roof"],
        correctOptionIndex: 1,
        explanation: "Keep your tongue in the middle - don't touch anywhere specific when hiding Ù†.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "What kind of Ghunnah do you make when hiding Ù†?",
        options: ["Loud Ghunnah", "Gentle, soft Ghunnah", "No Ghunnah", "Very long Ghunnah"],
        correctOptionIndex: 1,
        explanation: "Make a gentle, soft Ghunnah sound when hiding the Ù†.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ikhfa")!,
        prompt: "Which shows correct hiding of Ù†?",
        options: ["Ù…Ù† ØµØ§Ù„Ø­", "Ù…Ù† ÙŠÙ‚ÙˆÙ„", "Ù…Ù† Ø±Ø¨Ù‡", "Ù…Ù† Ø¨ÙŠØª"],
        correctOptionIndex: 0,
        explanation: "'Ù…Ù† ØµØ§Ù„Ø­' shows hiding because Øµ is one of the 15 hiding letters.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },

      // IQLAB QUESTIONS - Super Clear & Simple
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "Which letter makes Ù† change to Ù…?",
        options: ["Ø¨ only", "Ø± only", "ÙŠ only", "Ù… only"],
        correctOptionIndex: 0,
        explanation: "Only the letter Ø¨ makes Ù† change to Ù…. Just this one letter!",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "When Ù† meets Ø¨, what sound do you make instead?",
        options: ["ÙŠ sound", "Ùˆ sound", "Ù… sound", "Ø± sound"],
        correctOptionIndex: 2,
        explanation: "When Ù† meets Ø¨, change the Ù† to a Ù… sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "How should you say 'Ù…Ù† Ø¨Ø¹Ø¯'?",
        options: ["Say: Ù…Ù† Ø¨Ø¹Ø¯", "Say: Ù…Ù… Ø¨Ø¹Ø¯ (with Ghunnah)", "Say: Ù…Ù† Ù€Ø¹Ø¯", "Say: Ù…Ø¨ Ø¨Ø¹Ø¯"],
        correctOptionIndex: 1,
        explanation: "Say 'Ù…Ù… Ø¨Ø¹Ø¯' - change the Ù† to Ù… and make a gentle Ghunnah sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "What does 'changing the sound' mean?",
        options: ["Make it louder", "Say a different sound instead", "Skip it", "Say it twice"],
        correctOptionIndex: 1,
        explanation: "Changing means you say a different sound - Ù… instead of Ù†.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "When changing Ù† to Ù…, what do you do with your lips?",
        options: ["Keep lips open", "Close lips gently (don't touch completely)", "Press lips tightly", "Move lips quickly"],
        correctOptionIndex: 1,
        explanation: "Close your lips gently to make the Ù… sound, but don't press them tightly together.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "How long should you use Ghunnah when changing Ù† to Ù…?",
        options: ["Don't Ghunnah", "Count 1-2", "Count 1-2-3", "Count very long"],
        correctOptionIndex: 1,
        explanation: "Hum gently for 1-2 counts when changing Ù† to Ù….",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "Which word shows changing Ù† to Ù…?",
        options: ["Ø£Ù† ÙŠÙ‚ÙˆÙ„", "Ù…Ù† ØªØ­Øª", "Ù…Ù† Ø¨ÙŠØª", "Ù…Ù† Ø±Ø¨Ù‡"],
        correctOptionIndex: 2,
        explanation: "'Ù…Ù† Ø¨ÙŠØª' shows changing because Ù† meets Ø¨, so Ù† becomes Ù….",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "In the word 'Ø¹Ù†Ø¨', what happens?",
        options: ["Nothing changes", "Ù† becomes Ù… (say: Ø¹Ù…Ø¨)", "Ø¨ disappears", "Both sounds join"],
        correctOptionIndex: 1,
        explanation: "The Ù† changes to Ù…, so you say 'Ø¹Ù…Ø¨' with gentle Ghunnah.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "Why does Ù† change to Ù… before Ø¨?",
        options: ["Both Ù… and Ø¨ use your lips", "It sounds prettier", "It's easier to remember", "It's a random rule"],
        correctOptionIndex: 0,
        explanation: "Ù† changes to Ù… because both Ù… and Ø¨ are made with your lips, making it easier to say.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("iqlaab")!,
        prompt: "Do you use Ghunnah when changing Ù† to Ù…?",
        options: ["No Ghunnah ever", "Yes, gentle Ghunnah", "Yes, loud Ghunnah", "Sometimes Ghunnah"],
        correctOptionIndex: 1,
        explanation: "Yes, make gentle use Ghunnah when you change Ù† to Ù….",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },

      // IZHAR QUESTIONS - Super Clear & Simple
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "How many letters make you say Ù† clearly?",
        options: ["4 letters", "6 letters", "8 letters", "10 letters"],
        correctOptionIndex: 1,
        explanation: "6 letters make you say Ù† clearly: Ø£ Ù‡ Ø¹ Øº Ø­ Ø® (throat letters).",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "When you see these 6 letters after Ù†, what do you do?",
        options: ["Hide the Ù†", "Join the sounds", "Say Ù† clearly and separately", "Hum gently"],
        correctOptionIndex: 2,
        explanation: "Say the Ù† clearly and separately - don't join, hide, or Ghunnah.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "In 'Ù…Ù† Ø¹Ù†Ø¯', how should you say the Ù†?",
        options: ["Hide it", "Join it with Ø¹", "Say it clearly, then Ø¹", "Change it to Ù…"],
        correctOptionIndex: 2,
        explanation: "Say the Ù† clearly, then say Ø¹. Keep them separate.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "What does 'saying clearly' mean?",
        options: ["Say very loudly", "Say each sound separately and distinctly", "Say very quickly", "Say with Ghunnah"],
        correctOptionIndex: 1,
        explanation: "Saying clearly means pronounce each sound separately and distinctly.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "Where are these 6 clear-saying letters made?",
        options: ["With your lips", "With your tongue tip", "In your throat", "With your teeth"],
        correctOptionIndex: 2,
        explanation: "These 6 letters are made in your throat, so they're called throat letters.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "When saying Ù† clearly, do you Ghunnah?",
        options: ["Yes, always Ghunnah", "No, never Ghunnah", "Sometimes Ghunnah", "Hum very quietly"],
        correctOptionIndex: 1,
        explanation: "No Ghunnah! Just say the Ù† clearly without any nasal sound.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "How should you say 'Ù…Ù† Ø£Ø¬Ù„'?",
        options: ["Hide the Ù†", "Join Ù† and Ø£", "Say Ù† clearly, then Ø£", "Change Ù† to Ù…"],
        correctOptionIndex: 2,
        explanation: "Say the Ù† clearly, then say Ø£. Keep them separate because Ø£ is a throat letter.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "Which letter makes you say Ù† clearly?",
        options: ["Ø¨", "Øª", "Ø­", "Ù‚"],
        correctOptionIndex: 2,
        explanation: "Ø­ is one of the 6 throat letters that makes you say Ù† clearly.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "How long should you hold the Ù† when saying it clearly?",
        options: ["Very short", "Normal length (not extra long)", "Count 1-2", "Very long"],
        correctOptionIndex: 1,
        explanation: "Hold the Ù† for normal length - not extra short or extra long.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
      {
        ruleId: ruleMap.get("ith-har")!,
        prompt: "What makes clear-saying different from other rules?",
        options: ["It has Ghunnah", "It changes the Ù†", "It keeps Ù† separate and clear", "It hides the Ù†"],
        correctOptionIndex: 2,
        explanation: "Clear-saying is different because it keeps the Ù† separate and clear - no joining, hiding, or changing.",
        isActive: true,
        version: 1,
        createdAt: Date.now(),
      },
    ];

    // Insert all questions
    let insertedCount = 0;
    for (const question of simplifiedQuestions) {
      await ctx.db.insert("questions", question);
      insertedCount++;
    }

    console.log(`âœ… Successfully created ${insertedCount} ultra-clear questions`);
    return { count: insertedCount };
  },
});